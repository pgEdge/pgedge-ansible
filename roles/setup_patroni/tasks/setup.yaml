---

- name: Ensure Patroni configuration directory exists owned by our user
  file:
    path: /etc/patroni
    state: directory
    owner: "{{ ansible_facts['user_id'] }}"
    group: "{{ ansible_facts['user_id'] }}"
  become: true

- name: Create configuration file for Patroni node
  template:
    src: files/patroni.yaml.j2
    dest: /etc/patroni/patroni.yaml
    mode: 0600

- name: Enable and start the Patroni service
  service:
    name: patroni
    enabled: true
    state: started
  become: true
